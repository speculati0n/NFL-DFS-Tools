<!doctype html>
<html>
  <head>
    <title>NFL DFS Tools</title>
  </head>
  <body>
    <h1>NFL DFS Tools</h1>

    <h2>Upload Required Files</h2>
    <form action="/upload" method="post" enctype="multipart/form-data">
      <label>Site:</label>
      <input name="site" placeholder="dk or fd" required><br>
      <label>Projections (optional):</label>
      <input type="file" name="projections"><br>
      <label>Player IDs (optional):</label>
      <input type="file" name="players"><br>
      <label>Contest Structure (optional):</label>
      <input type="file" name="contest"><br>
      <label>Config (optional):</label>
      <input type="file" name="config"><br>
      <button type="submit">Upload Files</button>
      <button type="submit" formaction="/reset" formmethod="post">Reset to Repo Files</button>
    </form>

    <h2>Reset to Repo Files</h2>
    <form action="/reset" method="post">
      <label>Site:</label>
      <input name="site" placeholder="dk or fd" required><br>
      <button type="submit">Reset Data</button>
    </form>

    <h2>Optimize Lineups</h2>
    <form id="optimize-form" action="/optimize" method="post">
      <label>Site:</label>
      <input name="site" placeholder="dk or fd" required><br>
      <label>Number of Lineups:</label>
      <input name="num_lineups" type="number" required><br>
      <label>Number of Uniques:</label>
      <input name="num_uniques" type="number" value="1" required><br>
      <label>Mode:</label>
      <select name="mode">
        <option value="classic">Classic</option>
        <option value="showdown">Showdown</option>
      </select>
      <label><input type="checkbox" name="save_lineups"> Save lineups for simulator</label><br>
      <button type="submit">Run Optimizer</button>
    </form>

    <div id="progress" style="display:none;">
      <h3>Generating Lineups...</h3>
      <div id="progress-status">0/0 0%</div>
    </div>

    <h2>Simulate Tournament</h2>
    <form action="/simulate" method="post">
      <label>Site:</label>
      <input name="site" placeholder="dk or fd" required><br>
      <label>Field Size:</label>
      <input name="field_size" type="number" required><br>
      <label>Iterations:</label>
      <input name="num_iterations" type="number" required><br>
      <label>Mode:</label>
      <select name="mode">
        <option value="classic">Classic</option>
        <option value="showdown">Showdown</option>
      </select>
      <label><input type="checkbox" name="use_contest_data"> Use contest structure</label><br>
      <label><input type="checkbox" name="use_lineup_input"> Use saved lineups</label><br>
      <button type="submit">Run Simulation</button>
    </form>
    <script>
      document.getElementById('optimize-form').addEventListener('submit', async function(e) {
        e.preventDefault();
        const formData = new FormData(this);
        await fetch('/optimize', {method: 'POST', body: formData});
        document.getElementById('progress').style.display = 'block';
        poll();
      });
      async function poll() {
        const res = await fetch('/progress');
        const data = await res.json();
        document.getElementById('progress-status').innerText = `${data.current}/${data.total} ${data.percent}%`;
        if (data.status === 'done') {
          window.location.href = '/results';
        } else {
          setTimeout(poll, 1000);
        }
      }
    </script>
  </body>
</html>
